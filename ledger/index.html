<!DOCTYPE html>
<html lang="ru">
  <head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Блог Павла Попова</title>
  <meta name="title" content="Ledger – персональная бухгалтерия из командной строки">
  <meta name="description" content="Павел Попов">

  <meta property="og:url" content="/ledger/">
  <meta property="og:title" content="Ledger – персональная бухгалтерия из командной строки">
  
  <meta property="og:image" content="http://i.imgur.com/nKjlu9X.jpg">
  
  <meta property="og:type" content="article">
  <meta property="og:site_name" content="Павел Попов">
  <link rel="icon" type="image/png" href="/public/favicon.ico">
  <link rel="alternate" type="application/rss+xml" title="Блог Павла Попова" href="/blog-feed.xml">
  <link href="http://fonts.googleapis.com/css?family=PT+Serif:400,700,400italic|PT+Sans:400,700,400italic|Roboto:100,300|Roboto+Slab:300,400&amp;subset=latin,cyrillic" rel="stylesheet">
  <link href="/public/css/main.css" rel="stylesheet">

  <!-- CSS -->
  <!-- Icons -->
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/public/apple-touch-icon-precomposed.png">

  <!-- RSS -->
  <link rel="alternate" type="application/rss+xml" title="RSS" href="/atom.xml">

  <!-- Custom -->
  <script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.0/jquery.min.js"></script>
  <link  href="http://fotorama.s3.amazonaws.com/4.6.0/fotorama.css" rel="stylesheet"> <!-- 3 KB -->
<script src="http://fotorama.s3.amazonaws.com/4.6.0/fotorama.js"></script> <!-- 16 KB -->
  <script src="/public/js/dug.js"></script>
  <script src="/public/js/application.js"></script>
</head>

<body>
<header class="row-1">
  <nav class="title-nav" role="navigation">
    <h1 class="title-nav-header"><a href="/">Павел Попов</a>
      <span class="title-nav-slash">/</span>
      <a href="/">Блог</a>
    </h1>
  </nav>
</header>

  <section class="single-entry row-1" role="main">
  <article class="entry">
    
  
  
  




  <header class="entry-header">
    <h1 class="entry-title">
      <a href="/ledger/">Ledger – персональная бухгалтерия из командной строки</a>
    </h1>
  </header>

  <div class="entry-body content-area">
    
      <div class="entry-cover">
        <img src="http://i.imgur.com/nKjlu9X.jpg" alt="Ledger – персональная бухгалтерия из командной строки">
      </div>
    

    <p>Используем <a href="http://ledger-cli.org">ledger</a> для ведения домашней бухгалтерии.</p>

<!--more-->

<p>Вот пример транзакции:</p>

<pre><code>2014/05/12 Карта в метро
    Expenses:Проезд:Метро  1200 ; на карту Тройка
    Assets:Кошелек
</code></pre>

<p>В транзакции указано, что перевели 1200 чего-то (в моем случае – рублей) на
счет Expenses:Проезд:Метро со счета Assets:Кошелек. На самом деле, у
Assets:Кошелек стоит -1200, но ledger понимает это в неявном виде. Двоеточие
является разделителем иерархии счетов.</p>

<p>Сам ledger в журнал транзакций никаких изменений не вносит, его задача –
прочитать файл, построить баланс по всем счетам и вывести отчет пользователю.</p>

<p>Ledger это система видения бухгалтерии по принципам бухгалтерского учета, т.е. с
двойной записью. Основой являются транзакции (или проводки в
банковских терминах), переводящие деньги с одного счета на другой. При этом
деньги ни откуда не появляются и никуда не исчезают. Все счета принято делить на 5
категорий — Expenses (расходы), Assets (активы), Liabilities (обязательства –
кредиты, например), Income (доходы) и Equity (капитал). Это устоявшаяся бухгалтерская
терминология, слагаемые подчиняются основному правилу бухучета. Подробнее в
Википедии — <a href="http://en.wikipedia.org/wiki/Accounting_equation">Accounting Equation</a>.</p>

<p>При этом, у счетов типа Income в суммах будет стоять минус, что отражает
уменьшение денег у источника дохода, когда он платит вам.</p>

<p>Создаем запись с начальным остатком, например такую</p>

<pre><code>; OPENING
2014/05/01 * Opening balances
    Liabilities:Alfa Bank:кредитная карта     -12,345.0
    Liabilities:HomeCredit:кредитная карта    -44,422.0
    Assets:Alfa Bank:текущий счет              124,344.10
    Assets:Alfa Bank:Блиц-доход                39,500.05
    Assets:Alfa Bank:Блиц-доход              € 1,500.12
    Assets:Alfa Bank:Блиц-доход              $ 8,124.44
    Assets:Alfa Bank:текущий счет            € 400.44
    Assets:HomeCredit:вклад                    11180.66
    Equity:Opening Balances
</code></pre>

<p>ledger сам понимает, что валюты разные и учитывает их отдельно. Результатом
работы команды <code>ledger -f data.journal balance</code> будет:</p>

<pre><code>          175,024.81
        EUR 1,900.56
        USD 8,124.44  Assets
          163,844.15
        EUR 1,900.56
        USD 8,124.44    Alfa Bank
          124,344.10
          EUR 400.44      current
           39,500.05
        EUR 1,500.12
        USD 8,124.44      deposit
           11,180.66    HomeCredit:deposit
         -118,257.81
       EUR -1,900.56
       USD -8,124.44  Equity:Opening Balances
          -56,767.00  Liabilities
          -12,345.00    Alfa Bank:credit card
          -44,422.00    HomeCredit:credit card
--------------------
                   0
</code></pre>

<p>Счета, разделенные <code>:</code>, ledger понимает как иерархические и строит по
ним дерево. Баланс сходится в 0. Можно выводить только нужные
категории. Например, чтобы оценить текущий баланс нужно вывести категории Assets
и Liabilities:</p>

<pre><code>C:\Users\rbd\ledger&gt;hledger -f data.journal balance Assets Liabilities
         175,024.81
       EUR 1,900.56
       USD 8,124.44  Assets
         163,844.15
       EUR 1,900.56
       USD 8,124.44    Alfa Bank
         124,344.10
         EUR 400.44      current
          39,500.05
       EUR 1,500.12
       USD 8,124.44      deposit
          11,180.66    HomeCredit:deposit
         -56,767.00  Liabilities
         -12,345.00    Alfa Bank:credit card
         -44,422.00    HomeCredit:credit card
-------------------
         118,257.81
       EUR 1,900.56
       USD 8,124.44
</code></pre>

<p>(суммы выше полностью вымышленные)</p>

<p>Помимо самого ledger есть много проектов, вдохновленных оригинальным
приложением. Самым значительным можно считать <a href="http://hledger.org">hledger</a>, написанный на
Haskell.  Hledger совместим по формату журнала с ledger, но не поддерживает
некоторый синтаксис. Различия можно почитать на странице проекта. Для
большинства режимов использования они идентичны. В комплекте с hledger
поставляется компонент hledger-web, позволяющий поднять веб-сервер со страницей
управления журналом и получения различной аналитики и графики из браузера.</p>

<p>Под Windows, ledger и hledger не могут отображать юникод. Hledger даже
отказывается понимать русский текст в журнале, поэтому в примере выше я писал
все на английском. Под OSX и Linux все в порядке, можно использовать юникодные
символы, включая новомодный знак рубля.</p>

<p>Самая большая проблема при работе с ledger – ввод данных. Я решил эту проблему
следующим образом: под OS X я веду журнал в nvAlt, который синхронизуется с
Simplenote, на айфоне я использую приложение Simplenote для добавления новых
транзакций в журнал. Обновлять журнал я стараюсь регулярно, чем реже обновляешь,
тем больше вероятность забыть о чем-нибудь.</p>



    
  </div>

  
  <footer class="entry-footer">
    <time class="entry-timestamp">12 Apr 2014</time>
  </footer>
  

  </article>
</section>



  <!-- Yandex.Metrika counter -->
<script type="text/javascript">
(function (d, w, c) {
    (w[c] = w[c] || []).push(function() {
        try {
            w.yaCounter21201856 = new Ya.Metrika({id:21201856,
                    clickmap:true,
                    trackLinks:true,
                    accurateTrackBounce:true});
        } catch(e) { }
    });

    var n = d.getElementsByTagName("script")[0],
        s = d.createElement("script"),
        f = function () { n.parentNode.insertBefore(s, n); };
    s.type = "text/javascript";
    s.async = true;
    s.src = (d.location.protocol == "https:" ? "https:" : "http:") + "//mc.yandex.ru/metrika/watch.js";

    if (w.opera == "[object Opera]") {
        d.addEventListener("DOMContentLoaded", f, false);
    } else { f(); }
})(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="//mc.yandex.ru/watch/21201856" style="position:absolute; left:-9999px;" alt="" /></div>
</noscript>
<!-- /Yandex.Metrika counter -->

</body>
</html>
