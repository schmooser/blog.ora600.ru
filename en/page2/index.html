<!DOCTYPE html>
<html lang="ru">
  <head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Pavel Popov's Blog</title>
  <meta name="title" content="">
  <meta name="description" content="Pavel Popov">

  <meta property="og:url" content="/page2/index.html">
  <meta property="og:title" content="">
  
  <meta property="og:type" content="article">
  <meta property="og:site_name" content="Pavel Popov">
  <link rel="icon" type="image/png" href="/en/public/favicon.ico">
  <link rel="alternate" type="application/rss+xml" title="Pavel Popov's Blog" href="/blog-feed.xml">
  <link href="http://fonts.googleapis.com/css?family=PT+Serif:400,700,400italic|PT+Sans:400,700,400italic|Roboto:100,300|Roboto+Slab:300,400&amp;subset=latin,cyrillic" rel="stylesheet">
  <link href="/en/public/css/main.css" rel="stylesheet">

  <!-- CSS -->
  <!-- Icons -->
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/en/public/apple-touch-icon-precomposed.png">

  <!-- RSS -->
  <link rel="alternate" type="application/rss+xml" title="RSS" href="/atom.xml">

  <!-- Custom -->
  <script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.0/jquery.min.js"></script>
  <link href="http://fotorama.s3.amazonaws.com/4.4.9/fotorama.css" rel="stylesheet">
  <script src="http://fotorama.s3.amazonaws.com/4.4.9/fotorama.js"></script>
  <script src="/en/public/js/dug.js"></script>
  <script src="/en/public/js/application.js"></script>
</head>

<body>
<header class="row-1">
  <nav class="title-nav" role="navigation">
    <h1 class="title-nav-header"><a href="/">Pavel Popov</a>
      <span class="title-nav-slash">/</span>
      <a href="/en/">Blog</a>
    </h1>
  </nav>
</header>

  <section class="entry-list row-1" role="main">
  
    
  
  
  



  


<article class="entry">
  <header class="entry-header">
    <h1 class="entry-title">
      <a href="/en/oracle-aggregate-functions-on-empty-set/">Aggregate functions in Oracle on empty data set</a>
    </h1>
  </header>

  <div class="entry-body content-area">
    

    <p>I found an interesting thing about aggregate functions in Oracle. I knew then
when you invoke <code>count(*)</code> you’ll always get rows - at least one - even if
result set is empty (no rows are returned). In this case you’ll get 0 rows in
count, it’s expected and easy-to-think-of behaviour.</p>

<p>But I thought that when you invoke other than <code>count(*)</code> aggregate function e.g.
<code>max(1)</code> on empty result set then you’ll get no rows at all. I was wrong and in
this case you’ll get one row with NULL as it’s result. I think it’s the ISO
standard that says that when you apply aggregate function there can’t be empty
set in result.</p>

<p>Examples:</p>

<pre><code>SQL&gt; SELECT count(*) FROM dual WHERE 1=2;

COUNT(*)
--------
       0

SQL&gt; SELECT max(1) FROM dual WHERE 1=2;

MAX(1)
------
       &lt;- Here is 1 row with NULL value
</code></pre>



    
  </div>

  
</article>

  
    
  
  
  



  


<article class="entry">
  <header class="entry-header">
    <h1 class="entry-title">
      <a href="/en/vorax/">Using Vorax in OS X</a>
    </h1>
  </header>

  <div class="entry-body content-area">
    

    <p><a href="http://vorax-ide.blogspot.com">Vorax</a> is a plugin for vim which turns it to full-featured Oracle IDE
on your fingertips. It merges SQL*Plus functionality inside vim in native way.
Now version 4 is under active development.</p>

<p>But it’s kind of geeky to use it and install. I used to use it on Windows
environment and it was kind of pain. But Windows has dozen of good Oracle
IDE’s, like TOAD or PL/SQL Developer. Now I’m on OS X and the only option is
Oracle’s SQL Developer which is free but has terrible UI and bad performance.
That’s why I decided to try Vorax again.</p>

<p>After about a month of wars with environment, different ruby versions, and so
on, I finally made all work and will cover what I did here.</p>

<p>First of all, I tried to use <a href="https://mxcl.github.io/homebrew/">homebrew</a> as OS X package manager.
It’s very simple and useful. Go use it.</p>

<p>I also switched from bash to zsh. At the first time I used <a href="https://github.com/robbyrussell/oh-my-zsh">oh-my-zsh</a>
as the set of extensions. Then I switched to <a href="https://github.com/skwp/dotfiles">yadr</a> which brings a lot of
other staff, such as dozens of vim plugins, config files for git, hg, svn, tons
of shortcuts and so on. After using it about for about a three weeks I decided
that I want control of myself on whole this mess and deleted almost all
dot-started files and dirs from my HOME. And started a new life. I installed
oh-my-zsh again and tweaked it. I also put all my dotfiles into a separate
directory and put it on <a href="https://github.com/schmooser/rbddotfiles">GitHub</a>.</p>

<p>All this on Vorax is also worked on Windows. See
[here][install-vorax-on-windows] for the installation
process of Vorax on Windows.</p>

<h2 id="vorax">Vorax</h2>

<p>There is an issue with Vorax and MacVim installed via homebrew. Such MacVim is
compiled with system Ruby, which is 1.8 and is not supported by Vorax. I have
RVM with Ruby 1.9.3 which is ok, but homebrew’s MacVim doesn’t see it. That’s a
known issue and the way to go around it is to compile MacVim manually. I did it
as described in <a href="https://github.com/b4winckler/macvim/wiki/Building">manual</a> and now it works with Vorax.</p>

<p>I also made shell script <a href="https://github.com/schmooser/rbddotfiles/blob/master/vorax.sh"><code>vorax.sh</code></a> (and aliased it with <code>vorax</code>)
to start MacVim with Vorax plugin loaded because I don’t always need Oracle and
Vorax and there are some problems in OS X with <code>DYLD_LIBRARY_PATH</code>. See
<a href="/sqlplus-on-os-x/">this post</a> for details.</p>

<p>Here I will explain tips and tricks to work with Vorax. I use
<a href="https://github.com/talek/vorax4-beta">Vorax4-beta</a> and it doesn’t have all features for now, so I use
only those, which present.</p>

<h3 id="basic-usage">Basic usage</h3>

<p>In sql-buffer (file with sql extension) Vorax determines command and send them
to SQL*Plus. <code>,e</code> executes something under cursor. It can be SELECT statement,
DML or DDL statement, PL/SQL block or SQL*Plus command.</p>

<h3 id="using-omnicompletion">Using omnicompletion</h3>

<p>To use omnicompletion use <code>&lt;C-x&gt;&lt;C-o&gt;</code>. If it will find something to find, it’ll
show you a dialog to complete. Look at screenshot:</p>

<p><img src="/assets/vorax/omnicompletion.png" alt="Vorax screenshot" /></p>

<h3 id="explain-plan">Explain Plan</h3>

<p>To explain execution plan I do the following:</p>

<ol>
  <li>Append <code>explain plan for</code> before SQL statement and execute it. The result is <code>Explained</code>.</li>
  <li>Do <code>select * from table(dbms_xplan.display);</code>. The output is the desired plan.</li>
</ol>

<h3 id="vorax-configuration">Vorax configuration</h3>

<p>I use this Vorax-specified settings in my <code>.vimrc</code>:</p>

<ul>
  <li><code>let g:vorax_output_window_default_funnel = 2 " This sets up Vorax to use PAGEZIP default output window style</code></li>
  <li><code>set omnifunc=syntaxcomplete#Complete " Enables autocompletion</code></li>
</ul>

<hr />

<p>To be continued…</p>



    
  </div>

  
</article>

  
    
  
  
  



  


<article class="entry">
  <header class="entry-header">
    <h1 class="entry-title">
      <a href="/en/installing-cx_oracle-on-os-x/">Installing Oracle Instant Client and python's cx_Oracle on OS X Mountain Lion</a>
    </h1>
  </header>

  <div class="entry-body content-area">
    

    <p>I’ve encountered some problems with installing cx_Oracle python module on OS X Mountain Lion.</p>

<p>There are many <a href="http://mechanicalcat.net/richard/log/Python/Compiling_cx_Oracle_on_OS_X">hints</a>, <a href="http://stackoverflow.com/questions/8169946/cant-get-cx-oracle-to-work-with-python-version-2-7-mac-os-10-7-2-lion-mis">tips</a> and <a href="http://www.iceycake.com/2012/02/tutorial-how-to-install-cx_oracle-python-on-mac-os-x-lion/">tutorials</a>, which covers installation process, but none of them worked for me.</p>

<p>But the straightforward way worked:</p>

<ol>
  <li>Download all parts of 64-bit <a href="http://www.oracle.com/technetwork/topics/intel-macsoft-096467.html">Oracle Instant Client</a> version 11.2</li>
  <li>Unzip all in some folder, I unzipped in <code>/usr/local/oracle/instantclient_11_2_x64/instantclient_11_2</code></li>
  <li>
    <p>Create a bash script with environment variables. I named mine <code>.sqlplus.env</code> and load it when needed (more in <a href="/sqlplus-on-os-x/">this post</a>):</p>

    <pre><code># adding sqlplus variables when they needed
export ORACLE_HOME=/usr/local/oracle/instantclient_11_2_x64/instantclient_11_2
export SQLPATH=$ORACLE_HOME
export LD_LIBRARY_PATH=$ORACLE_HOME
export DYLD_LIBRARY_PATH=$ORACLE_HOME
export TNS_ADMIN=/usr/local/oracle/network/admin
export NLS_LANG=AMERICAN_AMERICA.UTF8
export VERSIONER_PYTHON_PREFER_32_BIT=yes
export PATH=$SQLPATH:$PATH
</code></pre>
  </li>
  <li>Load it with <code>$ . ~/.sqlplus.env</code></li>
  <li>
    <p>Go to $ORACLE_HOME and create symlink named <code>libclntsh.dylib</code> on <code>ibclntsh.dylib.11.1</code>:</p>

    <pre><code>ln -s libclntsh.dylib.11.1 libclntsh.dylib
</code></pre>
  </li>
  <li>
    <p>Install cx_Oracle:</p>

    <pre><code>~ » pip install cx_Oracle
Downloading/unpacking cx-Oracle
  Downloading cx_Oracle-5.1.2.tar.gz (208kB): 208kB downloaded
  Running setup.py egg_info for package cx-Oracle

Installing collected packages: cx-Oracle
  Running setup.py install for cx-Oracle
    building 'cx_Oracle' extension
    cc -fno-strict-aliasing -fno-common -dynamic -I/usr/local/include -I/usr/local/opt/sqlite/include -DNDEBUG -g -fwrapv -O3 -Wall -Wstrict-prototypes -I/usr/local/oracle/instantclient_11_2_x64/instantclient_11_2/sdk/include -I/usr/local/Cellar/python/2.7.5/Frameworks/Python.framework/Versions/2.7/include/python2.7 -c cx_Oracle.c -o build/temp.macosx-10.8-x86_64-2.7-11g/cx_Oracle.o -DBUILD_VERSION=5.1.2
    cc -bundle -undefined dynamic_lookup -L/usr/local/lib -L/usr/local/opt/sqlite/lib build/temp.macosx-10.8-x86_64-2.7-11g/cx_Oracle.o -L/usr/local/oracle/instantclient_11_2_x64/instantclient_11_2 -lclntsh -o build/lib.macosx-10.8-x86_64-2.7-11g/cx_Oracle.so -shared-libgcc

Successfully installed cx-Oracle
Cleaning up...
</code></pre>
  </li>
  <li>
    <p>Check if all is running:</p>

    <pre><code>~ » python
Python 2.7.5 (default, Jun  8 2013, 12:45:21)
[GCC 4.2.1 Compatible Apple LLVM 4.2 (clang-425.0.28)] on darwin
Type "help", "copyright", "credits" or "license" for more information.
&gt;&gt;&gt; import cx_Oracle
&gt;&gt;&gt; exit()
</code></pre>
  </li>
</ol>

<p>If there are some errors, try methods described in the links above. You may need to recompile <code>cx_Oracle</code>. To do this uninstall it with <code>pip uninstall cx_Oracle</code>, remove pip’s cache via</p>

<pre><code>$ rm -rf $TMPDIR/pip-build-{username}/
</code></pre>

<p>and then try to install <code>cx_Oracle</code> again.</p>



    
  </div>

  
</article>

  
    
  
  
  



  


<article class="entry">
  <header class="entry-header">
    <h1 class="entry-title">
      <a href="/en/increasing-memory-of-oracle-xe/">Increasing memory available for Oracle XE 11g</a>
    </h1>
  </header>

  <div class="entry-body content-area">
    

    <p>Suppose, you created virtual machine with 1G of RAM and installed Oracle XE on it. In this case Oracle supposedly will use only 512M of RAM. This happened on my CentOS installation.</p>

<p>Then suppose you upgraded your server to 2G and want to allow Oracle to use it’s maximum of 1G RAM. 
To get this do the following:</p>

<ol>
  <li>
    <p>Check your parameters <code>MEMORY_TARGET</code> and <code>MEMORY_MAX_TARGET</code>. Mine was set to ~400M both. You need to increase them to 1G. Due to unavailability to set <code>MEMORY_MAX_TARGET</code> in runtime we have to set it in spfile and restart the instance.</p>
  </li>
  <li>
    <p>Set parameters:</p>

    <pre><code>SQL&gt; ALTER SYSTEM SET MEMORY_MAX_TARGET=1G SCOPE=SPFILE;
SQL&gt; ALTER SYSTEM SET MEMORY_TARGET=1G SCOPE=SPFILE;
SQL&gt; SHUTDOWN IMMEDIATE;
</code></pre>
  </li>
  <li>
    <p>Check for available shared memory in order to pass through ORA-00845. Use <code>df -h</code> and look for size of <code>/dev/shm</code>. It should be at least as your <code>MEMORY_TARGET</code> size. If it’s lesser — increase it with</p>

    <pre><code># umount /dev/shm
# mount /dev/shm -o size=2048m
</code></pre>

    <p>Also be sure to set size in <code>/etc/fstab</code>:</p>

    <pre><code>none             /dev/shm      tmpfs   defaults,size=2048m          0 0
</code></pre>
  </li>
  <li>
    <p>Startup Oracle. It should now use 1G for <code>MEMORY_TARGET</code>.</p>
  </li>
</ol>



    
      <a href="/en/increasing-memory-of-oracle-xe/" class="read-link">Читать</a>
    
  </div>

  
</article>

  
    
  
  
  



  


<article class="entry">
  <header class="entry-header">
    <h1 class="entry-title">
      <a href="/en/quick-sort/">Quick sort in Haskell and Python</a>
    </h1>
  </header>

  <div class="entry-body content-area">
    

    <p>While reading <a href="http://learnyouahaskell.com/chapters">Learn you a Haskell for great good</a> I found <a href="http://learnyouahaskell.com/recursion#quick-sort">realization</a> of quick sort algorithm. It’s easy to understand in terms of recursion – for each element sorted array is <code>"sorted array of elements which are less then current" + "current element" + "sorted array of elements which are greater or equal then current"</code>.</p>

<p>Realization in Haskell:</p>

<pre><code>quicksort :: (Ord a) =&gt; [a] -&gt; [a]  
quicksort [] = []  
quicksort (x:xs) =   
    let smallerSorted = quicksort [a | a &lt;- xs, a &lt;= x]  
        biggerSorted = quicksort [a | a &lt;- xs, a &gt; x]  
    in  smallerSorted ++ [x] ++ biggerSorted
</code></pre>

<p>I tried to realize this in Python. That’s what I get:</p>

<pre><code>def qsort(input):
  if input == []: return [] 
  x, xs = input[0], input[1:]
  bigger = qsort(filter(lambda e: e &gt;= x, [ a for a in xs ]))
  smaller = qsort(filter(lambda e: e &lt; x, [ a for a in xs ]))
  return smaller + [x] + bigger
</code></pre>

<p>It works pretty well:</p>

<pre><code>&gt;&gt;&gt; qsort([4,2,6,3,6,4,23,76,3,5,2])
[2, 2, 3, 3, 4, 4, 5, 6, 6, 23, 76]    
&gt;&gt;&gt; qsort('Sample text')
[' ', 'S', 'a', 'e', 'e', 'l', 'm', 'p', 't', 't', 'x']
</code></pre>



    
  </div>

  
</article>

  
    
  
  
  



  


<article class="entry">
  <header class="entry-header">
    <h1 class="entry-title">
      <a href="/en/install-oracle-xe-on-centos-6/">Install Oracle 11g Express (XE) on CentOS</a>
    </h1>
  </header>

  <div class="entry-body content-area">
    

    <blockquote>
  <p>This is full copy of the <a href="http://www.davidghedini.com/pg/entry/install_oracle_11g_xe_on">post</a> by David Ghedini for backup purposes.</p>

  <p>Refer to <a href="/installing-oracle-xe-11gr2-on-centos-6/">my post</a> about swap file on server and localhost’s name.</p>
</blockquote>

<p>This post will cover basic installation and configuration of Oracle 11g Express Edition (XE) on CentOS.</p>

<p>We will also take a quick look at configuring Application Express (APEX) for 11g XE.</p>

<p>Basic installation is straight forward.</p>

<p>If you just want to get up and running, you can just do steps 1 to 4 below (and 10 and 11 for Apex). The remaining steps (5 to 9) cover basic backup, recovery, and performance configuration.</p>

<p>The full system requirements are <a href="http://download.oracle.com/docs/cd/E17781_01/install.112/e18802/toc.htm">here</a>.</p>

<p>Your CentOS box should have swap equal to 2xRAM. <em>(look at <a href="/installing-oracle-xe-11gr2-on-centos-6/">my post</a>)</em></p>

<p>On every CentOS installation I have done for XE, I just needed to update/install the packages for libaio, bc, and flex.</p>

<pre><code>[root@ms3 ~]#  yum install libaio bc flex
</code></pre>

<h2 id="step-1-download-and-install-oracle-11g-xe-rpm">Step 1: Download and Install Oracle 11g XE rpm</h2>

<p>You can download the Oracle XE rpm, <code>oracle-xe-11.2.0-1.0.x86_64.rpm.zip</code>, from the OTN [here][download-xe].</p>

<p>Unzip <code>oracle-xe-11.2.0-1.0.x86_64.rpm.zip</code>:</p>

<pre><code>[root@ms3 ~]# unzip -q oracle-xe-11.2.0-1.0.x86_64.rpm.zip
</code></pre>

<p>This will create the directory <code>Disk1</code>. Change to the <code>Disk1</code> directory:</p>

<pre><code>[root@ms3 ~]# cd Disk1  
[root@ms3 Disk1]# ls  
oracle-xe-11.2.0-1.0.x86_64.rpm  response  upgrade  
</code></pre>

<p>Install the rpm using <code>rpm -ivh oracle-xe-11.2.0-1.0.x86_64.rpm</code></p>

<pre><code>[root@ms3 Disk1]# rpm -ivh oracle-xe-11.2.0-1.0.x86_64.rpm  
Preparing...                ###################### [100%]  
   1:oracle-xe              ###################### [100%]  
Executing post-install steps...  
You must run '/etc/init.d/oracle-xe configure' as the root user to configure the database.

[root@ms3 Disk1]#  
</code></pre>

<h2 id="step-2-configure-11g-xe-database-and-options">Step 2: Configure 11g XE Database and Options</h2>

<p>When installation completes, run <code>/etc/init.d/oracle-xe configure</code> to configure and start the database.</p>

<p>Unless you wish to change the ports, except the defaults and set SYS/SYSTEM password. </p>

<pre><code>[root@ms3 Disk1]# /etc/init.d/oracle-xe configure

Oracle Database 11g Express Edition Configuration
-------------------------------------------------
This will configure on-boot properties of Oracle Database 11g Express
Edition.  The following questions will determine whether the database should
be starting upon system boot, the ports it will use, and the passwords that
will be used for database accounts.  Press &lt;enter&gt; to accept the defaults.
Ctrl-C will abort.

Specify the HTTP port that will be used for Oracle Application Express [8080]:

Specify a port that will be used for the database listener [1521]:

Specify a password to be used for database accounts.  Note that the same
password will be used for SYS and SYSTEM.  Oracle recommends the use of
different passwords for each database account.  This can be done after
initial configuration:
Confirm the password:

Do you want Oracle Database 11g Express Edition to be started on boot (y/n) [y]:y

Starting Oracle Net Listener...Done
Configuring database...Done
Starting Oracle Database 11g Express Edition instance...Done
Installation completed successfully.
</code></pre>

<p>The installation created the directory <code>/u01</code> under which Oracle XE is installed.</p>

<h2 id="step-3-set-the-environment">Step 3: Set the Environment</h2>

<p>To set the required Oracle environment variables, use the <code>oracle_env.sh</code> script included under <code>/u01/app/oracle/product/11.2.0/xe/bin</code>:</p>

<pre><code>[root@ms3 Disk1]# cd /u01/app/oracle/product/11.2.0/xe/bin  
</code></pre>

<p>To set the environment for your current session run:</p>

<pre><code>[root@ms3 bin]# . ./oracle_env.sh  
</code></pre>

<p>To set the environment permanently for users, add the following to the <code>.bashrc</code> or <code>.bash_profile</code> of the users you want to access the environment:</p>

<pre><code>. /u01/app/oracle/product/11.2.0/xe/bin/oracle_env.sh  
</code></pre>

<p>You should now be able to access SQL*Plus:</p>

<pre><code>[root@ms3 bin]# sqlplus /nolog  
  
SQL*Plus: Release 11.2.0.2.0 Production on Wed Sep 21 08:17:26 2011  
  
Copyright (c) 1982, 2011, Oracle.  All rights reserved.  
  
SQL&gt; connect sys/&lt;password&gt; as sysdba  
Connected.  
SQL&gt;  
</code></pre>

<h2 id="step-4-allow-remote-access-to-oracle-11g-xe-gui">Step 4: Allow Remote Access to Oracle 11g XE GUI</h2>

<p>To allow remote access to Oracle 11g XE GUI (as well as Application Express GUI) issue the following from SQL*Plus:</p>

<pre><code>SQL&gt; EXEC DBMS_XDB.SETLISTENERLOCALACCESS(FALSE);  
  
PL/SQL procedure successfully completed.  
</code></pre>

<p>You should now be able to access the Oracle 11g XE Home Page GUI at:</p>

<pre><code>http://localhost:8080/apex/f?p=4950:1 -- note the port you've set during installation
</code></pre>

<p>Replace <code>localhost</code> above with your IP or domain as required.</p>

<p>Log in as <code>SYSTEM</code> using the password you selected in Step 2 above.</p>

<h2 id="step-5-move-the-flash-recovery-area-fast-recovery-area">Step 5: Move the Flash Recovery Area (Fast Recovery Area)</h2>

<p>To protect against disk failure, you should move the Flash Recovery Area to a separate disk.</p>

<p>This is actually now called the Fast Recovery Area, but the existing documentation still refers to it as the Flash Recovery Area</p>

<p>If a separate disk is not in your budget you should, at the very least, move the Flash Recovery Area to a partition other than the Oracle installation directory.</p>

<p>By default, the Fast Recovery Area will be located under <code>/u01/app/oracle/fast_recovery_area</code>:</p>

<pre><code>SQL&gt; show parameter DB_RECOVERY_FILE_DEST;  
  
NAME                                 TYPE        VALUE  
------------------------------------ ----------- ------------------------------  
db_recovery_file_dest                string      /u01/app/oracle/fast_recovery_area  
db_recovery_file_dest_size           big integer 10G  
SQL&gt;  
</code></pre>

<p>So, to move it elsewhere, first create the new directory</p>

<p>[root@ms3 ~]# mkdir /opt/fra  </p>

<p>Change the owner to oracle and the group to dba </p>

<pre><code>[root@ms3 ~]# chown oracle:dba /opt/fra  
</code></pre>

<p>Now, change the <code>DB_RECOVERY_FILE_DEST</code> to the location you selected above.</p>

<pre><code>SQL&gt; ALTER SYSTEM SET DB_RECOVERY_FILE_DEST = '/opt/fra';  
  
System altered.  
  
SQL&gt;  
</code></pre>

<p>To move the files use the <code>movelog.sql</code> script:</p>

<pre><code>SQL&gt; @?/sqlplus/admin/movelogs  
SQL&gt; SET FEEDBACK 1  
SQL&gt; SET NUMWIDTH 10  
SQL&gt; SET LINESIZE 80  
SQL&gt; SET TRIMSPOOL ON  
SQL&gt; SET TAB OFF  
SQL&gt; SET PAGESIZE 100  
SQL&gt; declare  
  2     cursor rlc is  
  3        select group# grp, thread# thr, bytes/1024 bytes_k  
  4          from v$log  
  5        order by 1;  
  6     stmt     varchar2(2048);  
  7     swtstmt  varchar2(1024) := 'alter system switch logfile';  
  8     ckpstmt  varchar2(1024) := 'alter system checkpoint global';  
  9  begin  
 10     for rlcRec in rlc loop  
 11    stmt := 'alter database add logfile thread ' ||  
 12                 rlcRec.thr || ' size ' ||  
 13                 rlcRec.bytes_k || 'K';  
 14        execute immediate stmt;  
 15        begin  
 16           stmt := 'alter database drop logfile group ' || rlcRec.grp;  
 17           execute immediate stmt;  
 18        exception  
 19           when others then  
 20              execute immediate swtstmt;  
 21              execute immediate ckpstmt;  
 22              execute immediate stmt;  
 23        end;  
 24        execute immediate swtstmt;  
 25     end loop;  
 26  end;  
 27  /  
  
PL/SQL procedure successfully completed.  
  
SQL&gt;  
</code></pre>

<p>Now, set an appropriate size for the Fast Recovery Area. Use <code>df -h</code> to insure that there is ample space.</p>

<pre><code>SQL&gt; ALTER SYSTEM SET DB_RECOVERY_FILE_DEST_SIZE = 20G;  
  
System altered.  
</code></pre>

<p>Verify the new location and size. </p>

<pre><code>SQL&gt; show parameter DB_RECOVERY_FILE_DEST;  
  
NAME                                 TYPE        VALUE  
------------------------------------ ----------- ------------------------------  
db_recovery_file_dest                string      /opt/fra  
db_recovery_file_dest_size           big integer 20G  
SQL&gt;  
</code></pre>

<h2 id="step-6-add-redo-log-members-to-groups">Step 6: Add Redo Log Members to Groups</h2>

<p>You should have at least two Redo Log Groups and each group should have at least two members.</p>

<p>Additionally, the members should be spread across disks (or at least directories)</p>

<p>For whatever reason, only one member is created per group on install.</p>

<p>You can view the redo log files using </p>

<pre><code>SQL&gt; SELECT * FROM V$LOGFILE;
</code></pre>

<p>Since the default location for the two members is the Flash Recovery Area, the two existing members have been moved to our new FRA.</p>

<p>You should now add an additional member for each group under <code>/u01/app/oracle/oradata/XE</code></p>

<pre><code>SQL&gt; ALTER DATABASE ADD LOGFILE MEMBER '/u01/app/oracle/oradata/XE/log1b.LOG' TO GROUP 1;  
  
Database altered.  
  
SQL&gt; ALTER DATABASE ADD LOGFILE MEMBER '/u01/app/oracle/oradata/XE/log2b.LOG' TO GROUP 2;  
  
Database altered.  
  
SQL&gt;  
</code></pre>

<h2 id="step-7-set-sessions-and-processes-parameters">Step 7: Set Sessions and Processes Parameters</h2>

<p>The default values for parameters and sessions is quite low on the default installation.</p>

<pre><code>SQL&gt; show parameters sessions;  
  
NAME                                 TYPE        VALUE  
------------------------------------ ----------- ------------------------------  
java_max_sessionspace_size           integer     0  
java_soft_sessionspace_limit         integer     0  
license_max_sessions                 integer     0  
license_sessions_warning             integer     0  
sessions                             integer     172  
shared_server_sessions               integer  
  
SQL&gt; show parameters processes;  
  
NAME                                 TYPE        VALUE  
------------------------------------ ----------- ------------------------------  
aq_tm_processes                      integer     0  
db_writer_processes                  integer     1  
gcs_server_processes                 integer     0  
global_txn_processes                 integer     1  
job_queue_processes                  integer     4  
log_archive_max_processes            integer     4  
processes                            integer     100  
</code></pre>

<p>You can increase these parameters.</p>

<p>After each change, you will need to restart the database.</p>

<p>Increase sessions and then bounce database.</p>

<pre><code>SQL&gt; alter system set sessions=250 scope=spfile;  
  
System altered.  
  
SQL&gt; shutdown immediate  
Database closed.  
Database dismounted.  
ORACLE instance shut down.  
SQL&gt; startup  
ORACLE instance started.  
  
Total System Global Area 1068937216 bytes  
Fixed Size                  2233344 bytes  
Variable Size             780143616 bytes  
Database Buffers          281018368 bytes  
Redo Buffers                5541888 bytes  
Database mounted.  
Database opened.  
</code></pre>

<p>Verify change to sessions parameter:</p>

<pre><code>SQL&gt; show parameters sessions;  
  
NAME                                 TYPE        VALUE  
------------------------------------ ----------- ------------------------------  
java_max_sessionspace_size           integer     0  
java_soft_sessionspace_limit         integer     0  
license_max_sessions                 integer     0  
license_sessions_warning             integer     0  
sessions                             integer     252  
shared_server_sessions               integer  
</code></pre>

<p>Increase processes and restart database</p>

<pre><code>SQL&gt; alter system set processes=200 scope=spfile;  
  
System altered.  
  
SQL&gt; shutdown immediate;
  
Database dismounted.  
ORACLE instance shut down.  
SQL&gt; startup  
ORACLE instance started.  
  
Total System Global Area 1068937216 bytes  
Fixed Size                  2233344 bytes  
Variable Size             763366400 bytes  
Database Buffers          297795584 bytes  
Redo Buffers                5541888 bytes  
Database mounted.  
Database opened.  
</code></pre>

<p>Verify change to processes parameter:</p>

<pre><code>SQL&gt;  show parameters processes;  
  
NAME                                 TYPE        VALUE  
------------------------------------ ----------- ------------------------------  
aq_tm_processes                      integer     0  
db_writer_processes                  integer     1  
gcs_server_processes                 integer     0  
global_txn_processes                 integer     1  
job_queue_processes                  integer     4  
log_archive_max_processes            integer     4  
processes                            integer     200  
SQL&gt;  
</code></pre>

<h2 id="step-8-enable-archivelog-mode">Step 8: Enable Archivelog Mode</h2>

<p>To enable online or “hot” backups, Archivelog Mode must be enabled.</p>

<p>Additionally, if you do not enable Archivelog Mode and take only offline or “cold” backups, should you need to restore the database you will only be able to restore to the last backup</p>

<p>To enable Archivelog Mode, shutdown the database and then startup mount:</p>

<pre><code>SQL&gt; shutdown immediate  
Database closed.  
Database dismounted.  
ORACLE instance shut down.  
SQL&gt; startup mount  
ORACLE instance started.  
  
Total System Global Area 1068937216 bytes  
Fixed Size                  2233344 bytes  
Variable Size             763366400 bytes  
Database Buffers          297795584 bytes  
Redo Buffers                5541888 bytes  
Database mounted.  
</code></pre>

<p>Enable Archivelog Mode</p>

<pre><code>SQL&gt; alter database archivelog;  
  
Database altered.  
</code></pre>

<p>Open the database and verify that Archivelog Mode is enabled</p>

<pre><code>SQL&gt; alter database open;  
  
Database altered.  
  
SQL&gt; SELECT LOG_MODE FROM SYS.V$DATABASE;  
  
LOG_MODE  
------------  
ARCHIVELOG  
  
SQL&gt;  
</code></pre>

<h2 id="step-9-create-online-backup-script">Step 9: Create Online Backup Script</h2>

<p>To create automated backups, you can modify the <code>backup.sh</code> included under <code>/u01/app/oracle/product/11.2.0/xe/config/scripts</code></p>

<p>Create a directory for your backup script</p>

<pre><code>[root@ms3 ~]# mkdir /opt/ora_backup  
</code></pre>

<p>Change the owner to oracle and the group to dba </p>

<pre><code>[root@ms3 ~]# chown oracle:dba /opt/ora_backup  
</code></pre>

<p>Copy the <code>backup.sh</code> script from <code>/u01/app/oracle/product/11.2.0/xe/config/scripts</code> to the directory you created above.</p>

<pre><code>[root@ms3 ~]# cp  /u01/app/oracle/product/11.2.0/xe/config/scripts/backup.sh /opt/ora_backup/backup.sh  
</code></pre>

<p>Open the <code>backup.sh</code> script in a text editor or vi. The last section will look like this:</p>

<pre><code>else  
   echo Backup of the database succeeded.  
   echo Log file is at $rman_backup_current.  
fi  
 
#Wait for user to press any key  
echo -n "Press ENTER key to exit"  
read userinp   
</code></pre>

<p>Change it to: </p>

<pre><code>else  
   echo Backup of the database succeeded.  
   echo Log file is at $rman_backup_current.  
   mail -s 'Oracle Backup Completed' 'david@davidghedini.com' &lt; /u01/app/oracle/oxe_backup_current.log  
fi  
 
#Wait for user to press any key  
#echo -n "Press ENTER key to exit"  
#read userinp   
</code></pre>

<p>The line we added above, <code>mail -s 'Oracle Backup Completed' 'david@davidghedini.com' &lt; /u01/app/oracle/oxe_backup_current.log</code>, will send us an email notification that the backup has completed as well as cat the backup log to the body of the email.</p>

<p>Note that we have also commented out the last two lines of the script (the prompt). </p>

<p>Create a cron job to run the script as user oracle.</p>

<p>You should run it at least once a day. With Archivelog Mode enabled, it is important that backups be taken regularly to prevent the Flash Recovery Area from filling. </p>

<h2 id="step-10-oracle-11g-xe-and-application-express-apex">Step 10: Oracle 11g XE and Application Express (APEX)</h2>

<p>Oracle 11g Express Edition comes with Application Express 4.0.2 already installed. </p>

<p>If you elect to upgrade to the latest version (4.1 as of this writing), you can do so but will loose access to the XE GUI. Not a huge loss, but something to keep in mind.</p>

<p>Although Apex is already installed, you will need to set the Internal Admin password.</p>

<p>To do so, run the apxchpwd.sql located under <code>/u01/app/oracle/product/11.2.0/xe/apex</code>:</p>

<p>Note: pick something simple like <code>Password123!</code> as you will be prompted to change it on first log in anyways.</p>

<pre><code>SQL&gt; @/u01/app/oracle/product/11.2.0/xe/apex/apxchpwd.sql  
Enter a value below for the password for the Application Express ADMIN user.  
  
  
Enter a password for the ADMIN user              []  
  
Session altered.  
  
...changing password for ADMIN  
  
PL/SQL procedure successfully completed.  
  
  
Commit complete.  
  
SQL&gt;  
</code></pre>

<p>You can access the Application Express GUI at:</p>

<pre><code>http://localhost:8080/apex/f?p=4550:1
</code></pre>

<p>Replace localhost above with your IP or domain as required.</p>

<pre><code>Workspace: Internal
User Name: admin
Password: (whatever you selected above).
</code></pre>

<p>Alternatively, you can access via <code>http://localhost:8080/apex/f?p=4550:10</code> or <code>http://localhost:8080/apex/apex_admin</code></p>

<p>Again, replace localhost above with your IP or domain as required.</p>

<h2 id="step-11-oracle-11g-xe-configure-epg-or-apex-listener">Step 11: Oracle 11g XE: Configure EPG or Apex Listener</h2>

<p>Unless you have a license for Oracle HTTP Server (OHS), your options are the embedded PLSQL Gateway (EPG) or Apex Listener. </p>

<p>The Application Express that comes installed with Oracle 11g XE is configured using the EPG.</p>

<p>While the EPG is simpler than Apex Listener, it can be painfully slow as of Apex 3.2. </p>

<p>Apex Listener, while quite fast, adds an extra layer of complexity. </p>

<p>You will need to install an application server to run Apex Listener.</p>

<p>I have run Apex Listener on both Tomcat (unsupported) as well as Oracle GlassFish 3.x (supported) and was not impressed with either.</p>

<p>A lot of people who know far more than I do about APEX (read: 99.9999% of the population) like the Apex Listener.</p>

<p>Apex Listener and it’s installation guide can be found <a href="http://www.oracle.com/technetwork/developer-tools/apex-listener/overview/index.html">here</a>.</p>

<p>The Apex Listener installation guide is well done and simple to follow.</p>

<p>If you need to install Oracle GlassFish or GlassFish CE (basic installation is the same), you can use my GlassFish 3.1 instructions <a href="http://www.davidghedini.com/pg/entry/install_glassfish_3_1_on">here</a>.</p>

<p>If you want to be an outlaw and use Tomcat, you can use my Tomcat 6 installation guide <a href="http://www.davidghedini.com/pg/entry/install_tomcat_6_on_centos">here</a>, or my Tomcat 7 installation guide <a href="http://www.davidghedini.com/pg/entry/install_tomcat_7_on_centos">here</a>.</p>



    
  </div>

  
</article>

  
    
  
  
  



  


<article class="entry">
  <header class="entry-header">
    <h1 class="entry-title">
      <a href="/en/sorting-ipc-transformations-usage-with-vim/">Sorting IPC transformations usage from log with VIM</a>
    </h1>
  </header>

  <div class="entry-body content-area">
    

    <p>IPC provides information about performance of transformations in session. It’s located in session’s log close to end of log. Format of the record is simple – “name of transformation: percentage of usage”. Unfortunately, transformations aren’t sorted in any fashion. To sort this in vim, I use such script:</p>

<pre><code>:sort! n r /[0-9]\+\.[0-9]\+/
</code></pre>

<p>Here <code>!</code> means reverse sorting, <code>n</code> stands for sorting using decimal number, <code>r</code> tells vim to use pattern to search, pattern <code>/{regex}/</code> searches through percentage of usage.</p>



    
  </div>

  
</article>

  
  <a href="/en/archive/" class="archive-link">→</a>
</section>



  <!-- Yandex.Metrika counter -->
<script type="text/javascript">
(function (d, w, c) {
    (w[c] = w[c] || []).push(function() {
        try {
            w.yaCounter21201856 = new Ya.Metrika({id:21201856,
                    clickmap:true,
                    trackLinks:true,
                    accurateTrackBounce:true});
        } catch(e) { }
    });

    var n = d.getElementsByTagName("script")[0],
        s = d.createElement("script"),
        f = function () { n.parentNode.insertBefore(s, n); };
    s.type = "text/javascript";
    s.async = true;
    s.src = (d.location.protocol == "https:" ? "https:" : "http:") + "//mc.yandex.ru/metrika/watch.js";

    if (w.opera == "[object Opera]") {
        d.addEventListener("DOMContentLoaded", f, false);
    } else { f(); }
})(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="//mc.yandex.ru/watch/21201856" style="position:absolute; left:-9999px;" alt="" /></div>
</noscript>
<!-- /Yandex.Metrika counter -->

</body>
</html>
