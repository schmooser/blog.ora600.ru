---
layout: post
title: Ledger – персональная бухгалтерия
lang: ru
category: finance
---

Я начал вести домашнюю бухгалтерию с лета 2010 года. В то время мои доходы и
расходы были практически одинаковы, и для больших трат мне приходилось копить.
Домашняя бухгалтерия помогает понять, на что тратятся деньги и какой текущий
остаток. Когда у вас десяток счетов в нескольких банках, да это еще и в разных
валютах, понять сколько денег есть довольно тяжело.

Начав поиски системы, в которой можно вести домашнюю бухгалтерию, я сначала
наткнулся на сервис ["Четыре конверта"][1]. Там выстроена целая система для
того, чтобы меньше тратить, а больше экономить. Попользовавшись пару месяцев я
ее бросил. Мне не нравился ни дизайн ни подход. К тому же у системы не было
никакого интересного функционала, например планирование бюджета, сравнение
периодов, графики и так далее.

Следующая система, которой я пользовался долгое время (4 года получается) ---
[ZenMoney][2]. В этой системе есть в принципе все, что мне нужно --- отличная
поддержка нескольких счетов, переводы, планируемые транзакции, бюджет. Критичная
проблема для меня всего одна --- частые ошибки сервиса, когда начинает
расходиться баланс или внезапно возникают давно покрытые долги. В таких случаях
приходится писать в саппорт сервиса, и если раньше они достаточно оперативно
исправляли ошибки, то начиная с 2014-го года они перестали это делать, в
результате у меня на странице "Обзор" долгов нет, а на странице транзакций висят
записи о долгах. После таких ошибок желание пользоваться сервисом пропало и я
начал задумываться о написании своей собственной системы видения домашней
бухгалтерии, благо что многие ведут ее в таблицах в Google Docs.

И тут я совершенно случайно наткнулся на [ledger][3]. Тема всплыла на HackerNews
и оказалось, что это очень продвинутая система, работающая в командной строке с
журналом транзакций. При этом журнал транзакций это обычный текстовый файл в
human-readable формате.

Вот пример транзакции:

    2014/05/12 комментарий
        Expenses:Проезд:Метро  1200
        Assets:Кошелек

В транзакции указано, что перевели 1200 чего-то (в моем случае -- рублей) на
счет Expenses:Проезд:Метро со счета Assets:Кошелек. На самом деле, у
Assets:Кошелек стоит -1200, но ledger понимает это в неявном виде. Двоеточие
является разделителем иерархии счетов.

Сам ledger в журнал транзакций никаких изменений не вносит, его задача --
прочитать файл, построить баланс по всем счетам и вывести отчет пользователю.

Ledger это система видения бухгалтерии по принципам бухгалтерского учета, т.е. с
двойной записью. Основой такого учета являются транзакции (или проводки в
банковских терминах), переводящие деньги с одного счета на другой. При этом
деньги ни откуда не появляются и никуда не исчезают. Все счета поделены на 5
категорий --- Expenses (расходы), Assets (активы), Liabilities (обязательства --
кредиты, например), Income (доходы) и Equity (капитал).

В начале создаем запись с начальным остатком, например такую

    ; OPENING
    2014/05/01 * Opening balances
        Liabilities:Alfa Bank:кредитная карта     -12,345.0
        Liabilities:HomeCredit:кредитная карта    -44,422.0
        Assets:Alfa Bank:текущий счет              124,344.10
        Assets:Alfa Bank:Блиц-доход                39,500.05
        Assets:Alfa Bank:Блиц-доход              € 1,500.12
        Assets:Alfa Bank:Блиц-доход              $ 8,124.44
        Assets:Alfa Bank:текущий счет            € 400.44
        Assets:HomeCredit:вклад                    11180.66
        Equity:Opening Balances

ledger сам понимает, что валюты разные и учитывает их отдельно. Результатом
работы команды `ledger -f data.journal balance` будет:

              175,024.81
            EUR 1,900.56
            USD 8,124.44  Assets
              163,844.15
            EUR 1,900.56
            USD 8,124.44    Alfa Bank
              124,344.10
              EUR 400.44      current
               39,500.05
            EUR 1,500.12
            USD 8,124.44      deposit
               11,180.66    HomeCredit:deposit
             -118,257.81
           EUR -1,900.56
           USD -8,124.44  Equity:Opening Balances
              -56,767.00  Liabilities
              -12,345.00    Alfa Bank:credit card
              -44,422.00    HomeCredit:credit card
    --------------------
                       0

Видно, что счета, разделенные `:` ledger понимает как иерархические и строит по
ним дерево. Баланс сходится в 0. Можно, естесственно, выводить только нужные
категории. Например, чтобы оценить текущий баланс нужно вывести категории Assets
и Liabilities:

    C:\Users\rbd\ledger>hledger -f data.journal balance Assets Liabilities
             175,024.81
           EUR 1,900.56
           USD 8,124.44  Assets
             163,844.15
           EUR 1,900.56
           USD 8,124.44    Alfa Bank
             124,344.10
             EUR 400.44      current
              39,500.05
           EUR 1,500.12
           USD 8,124.44      deposit
              11,180.66    HomeCredit:deposit
             -56,767.00  Liabilities
             -12,345.00    Alfa Bank:credit card
             -44,422.00    HomeCredit:credit card
    -------------------
             118,257.81
           EUR 1,900.56
           USD 8,124.44

Помимо самого ledger есть много проектов, вдохновленных оригинальным
приложением. Самым значительным можно считать [hledger][4], написанный на
Haskell.  Hledger совместим по формату журнала с ledger, но не поддерживает
некоторый синтаксис. Различия можно почитать на странице проекта. Для
большинства режимов использования они идентичны. В комплекте с hledger
поставляется компонент hledger-web, позволяющий поднять веб-сервер со страницей
управления журналом и получения различной аналитики и графики из браузера.

Я пишу этот текст под Windows, под которой и ledger и hledger не могут
отображать юникод. Hledger даже отказывается понимать русский текст в журнале,
поэтому в примере выше я писал все на английском. Под OSX и Linux все в порядке,
можно использовать юникодные символы, включая новомодный знак рубля.

Самая большая проблема при работе с ledger -- ввод данных. Мне, конечно, очень
удобно вводить данные прямо в журнал используя vim (для которого есть
соответствующие [плагины][5]), но иногда хочется внести данные прямо на месте,
например с iPhone. Для такого случая я написал простейшую [форму][6] ввода
транзакции. Теперь я ввожу данные прямо с телефона или из любого места. Надо
будет дописать выбор расходного и доходного счета, но я пока не до конца вижу
как это должно выглядеть.

[1]: http://www.4konverta.com
[2]: http://zenmoney.ru
[3]: http://ledger-cli.org
[4]: http://hledger.org
[5]: https://github.com/ledger/vim-ledger
[6]: http://ledger.ora600.ru

