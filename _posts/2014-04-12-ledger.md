---
layout: post
title: Ledger – персональная бухгалтерия
lang: ru
category: finance
image: http://img-fotki.yandex.ru/get/6743/9179339.d/0_86cdf_ee668cb4_-4-orig.png
---

Я начал вести домашнюю бухгалтерию с лета 2010 года. В то время мои доходы и
расходы были практически одинаковы, и для больших трат мне приходилось копить.
Поэтому, необходимо было как-то контролировать доходы и расходы.

Домашняя бухгалтерия помогает понять, на что тратятся деньги, какой текущий
остаток на счетах и показывает какие планируются траты. Когда у вас несколько
счетов в разных банках, да это еще и в разных валютах, понять сколько денег
в наличии довольно тяжело.

<!--more-->

Первым сервисом, который я попробовал был сервис ["Четыре конверта"][1]. Там
выстроена целая методика ведения бюджета и экономии денег, основанная на
выделении квоты на недели (4 недели в месяце). Попользовавшись пару месяцев я ее
бросил. Мне не понравился такой подход. К тому же у системы не было
никакого интересного функционала, это просто сайт. Выгрузить данные, сравнить
периоды по тратам, запланировать бюджет нельзя.

Следующая система ведения домашней бухгалтерии, которой я пользовался долгое
время (4 года) --- [ZenMoney][2]. В этой системе есть практически все, что мне
нужно --- поддержка нескольких счетов в разных валютах, переводы между счетами,
планируемые транзакции, бюджет. Критичная проблема сервиса для меня всего одна
--- частые ошибки, когда начинает расходиться баланс или, например, внезапно
возникают давно покрытые долги. В таких случаях приходится писать в саппорт
сервиса, и если раньше они достаточно оперативно исправляли ошибки, то начиная с
2014-го года они перестали это делать в принципе. Мой баг, когда на странице
"Обзор" долгов нет, а на странице транзакций висят записи о долгах. После таких
ошибок желание пользоваться сервисом пропало и я начал задумываться о написании
своей собственной системы видения домашней бухгалтерии, благо что многие ведут
ее в таблицах в Google Docs.

И тут я совершенно случайно наткнулся на [ledger][3]. Тема всплыла на HackerNews
и оказалось, что это очень продвинутая система, работающая из командной строки с
журналом транзакций. При этом журнал транзакций это обычный текстовый файл в
human-readable формате.

Вот пример транзакции:

    2014/05/12 комментарий
        Expenses:Проезд:Метро  1200
        Assets:Кошелек

В транзакции указано, что перевели 1200 чего-то (в моем случае -- рублей) на
счет Expenses:Проезд:Метро со счета Assets:Кошелек. На самом деле, у
Assets:Кошелек стоит -1200, но ledger понимает это в неявном виде. Двоеточие
является разделителем иерархии счетов.

Сам ledger в журнал транзакций никаких изменений не вносит, его задача --
прочитать файл, построить баланс по всем счетам и вывести отчет пользователю.

Ledger это система видения бухгалтерии по принципам бухгалтерского учета, т.е. с
двойной записью. Основой являются транзакции (или проводки в
банковских терминах), переводящие деньги с одного счета на другой. При этом
деньги ни откуда не появляются и никуда не исчезают. Все счета принято делить на 5
категорий --- Expenses (расходы), Assets (активы), Liabilities (обязательства --
кредиты, например), Income (доходы) и Equity (капитал). Это устоявшаяся бухгалтерская
терминология, слагаемые подчиняются основному правилу бухучета. Подробнее в
Википедии --- [Accounting Equation](http://en.wikipedia.org/wiki/Accounting_equation).

При этом, у счетов типа Income в суммах будет стоять минус, что отражает
уменьшение денег у источника дохода, когда он платит вам.

Создаем запись с начальным остатком, например такую

    ; OPENING
    2014/05/01 * Opening balances
        Liabilities:Alfa Bank:кредитная карта     -12,345.0
        Liabilities:HomeCredit:кредитная карта    -44,422.0
        Assets:Alfa Bank:текущий счет              124,344.10
        Assets:Alfa Bank:Блиц-доход                39,500.05
        Assets:Alfa Bank:Блиц-доход              € 1,500.12
        Assets:Alfa Bank:Блиц-доход              $ 8,124.44
        Assets:Alfa Bank:текущий счет            € 400.44
        Assets:HomeCredit:вклад                    11180.66
        Equity:Opening Balances

ledger сам понимает, что валюты разные и учитывает их отдельно. Результатом
работы команды `ledger -f data.journal balance` будет:

              175,024.81
            EUR 1,900.56
            USD 8,124.44  Assets
              163,844.15
            EUR 1,900.56
            USD 8,124.44    Alfa Bank
              124,344.10
              EUR 400.44      current
               39,500.05
            EUR 1,500.12
            USD 8,124.44      deposit
               11,180.66    HomeCredit:deposit
             -118,257.81
           EUR -1,900.56
           USD -8,124.44  Equity:Opening Balances
              -56,767.00  Liabilities
              -12,345.00    Alfa Bank:credit card
              -44,422.00    HomeCredit:credit card
    --------------------
                       0

Счета, разделенные `:`, ledger понимает как иерархические и строит по
ним дерево. Баланс сходится в 0. Можно выводить только нужные
категории. Например, чтобы оценить текущий баланс нужно вывести категории Assets
и Liabilities:

    C:\Users\rbd\ledger>hledger -f data.journal balance Assets Liabilities
             175,024.81
           EUR 1,900.56
           USD 8,124.44  Assets
             163,844.15
           EUR 1,900.56
           USD 8,124.44    Alfa Bank
             124,344.10
             EUR 400.44      current
              39,500.05
           EUR 1,500.12
           USD 8,124.44      deposit
              11,180.66    HomeCredit:deposit
             -56,767.00  Liabilities
             -12,345.00    Alfa Bank:credit card
             -44,422.00    HomeCredit:credit card
    -------------------
             118,257.81
           EUR 1,900.56
           USD 8,124.44

(суммы выше полностью вымышленные)

Помимо самого ledger есть много проектов, вдохновленных оригинальным
приложением. Самым значительным можно считать [hledger][4], написанный на
Haskell.  Hledger совместим по формату журнала с ledger, но не поддерживает
некоторый синтаксис. Различия можно почитать на странице проекта. Для
большинства режимов использования они идентичны. В комплекте с hledger
поставляется компонент hledger-web, позволяющий поднять веб-сервер со страницей
управления журналом и получения различной аналитики и графики из браузера.

Под Windows, ledger и hledger не могут отображать юникод. Hledger даже
отказывается понимать русский текст в журнале, поэтому в примере выше я писал
все на английском. Под OSX и Linux все в порядке, можно использовать юникодные
символы, включая новомодный знак рубля.

Самая большая проблема при работе с ledger -- ввод данных. Я решил эту проблему
следующим образом: под OS X я веду журнал в nvAlt, который синхронизуется с
Simplenote, на айфоне я использую приложение Simplenote для добавления новых
транзакций в журнал. Обновлять журнал я стараюсь регулярно, чем реже обновляешь,
тем больше вероятность забыть о чем-нибудь.

[1]: http://www.4konverta.com
[2]: http://zenmoney.ru
[3]: http://ledger-cli.org
[4]: http://hledger.org
[5]: https://github.com/ledger/vim-ledger
[6]: http://ledger.ora600.ru

