---
layout: post
title: Блокировка сессий и откат к savepoint 
lang: ru
category: oracle
---

[Интересный куиз](http://plsqlchallenge.com/pls/apex/f?p=10000:651:585965286409691::NO:651:P651_COMP_EVENT_ID,P651_QUIZ_ID:10840,11619&cs=1581E3AEBF2AA49892C68A59796A406B0) был вчера в PL/SQL Challenge, в нем обсуждалась взаимная блокировка сессий и откат к savepoint. 

Я думал, что если одна сессия заблокировала строку и в это время другая сессия пытается эту строку изменить, то 2-я сессия будет заблокирована до тех пор, пока первая сессия на совершит commit или rollback. Но про rollback to savepoint я как-то не задумывался. Я полага, если идет rollback to savepoint и 1-я сессия отпускает строку, то 2-я сессия разблокируется и сделает свое дело, оказался неправ – блокированная сессия ждет  освобождения ресурса (обновляемой строки), а завершения блокирующей транзакции (commit/rollback). Но, если после rollback to savepoint в 1-й сессии запустить 3-ю сессию, изменяющую ту же строку, то она уже не будет заблокирована ни 1-й сессий ни 2-й сессией (которая блокирована 1-й) и выполнится без ожиданий. 

Век живи, век учись. 
