---

layout: post  
title: Использование longtabu в LaTeX  
lang: ru  
category: latex  

---  

Стандартный `tabular` не поддерживает таблицы, которые не умещаются в одну страницу.

Для многостраничных таблиц есть пакет `longtable`, он разбивает таблицу на страницы, 
причем на каждой странице может выводить свой заголовок. Доступны следующие команды:
`\endfirsthead`, `\endhead`, `\endlastfoot`, `\endfoot`.
Они определяют заголовок на первой странице таблицы и на остальных страницах таблицы.
И подвал страницы на последней и остальных страницах, соответственно.

Примеры использования можно поискать в Гугле или, например, [тут][longtable-example].

Проблемы с `longtable` начинаются, если в таблице оказываются длинные данные. TeX 
по-умолчанию не умеет переносить содержимое ячеек на новую строчку. Чтобы активировать
перенос тип колонки должен быть не `l`,`r` или `c` (выравнивание влево, вправо или по
центру) а `p` (параграф) с указанием ширины в понятных для TeXа элементах (например, 
`p{1.1cm}`). Тогда, определив для каждой колонки размер, соотнеся его с `\textwidth`
можно добиться нормального расположения таблицы на странице (без сообщений в логе 
`Overfull \hbox`).

К счастью, есть более правильный способ -- использование пакета [`tabu`][tabu]. Он
добавляет к возможностям окружения `tabular` новый тип колонок - `X`. Это колонка,
ширина которой будет вычисляться автоматически.

Пример таблицы в окружении `tabu`:

    \begin{tabu} to \linewidth{lXr}
    
    $r_1c_1$ & $r_1c_2$ & $r_1c_3$ \\
    $r_2c_1$ & $r_2c_2$ & $r_2c_3$ \\
    $r_3c_1$ & $r_3c_2$ & $r_3c_3$ \\
    
    \end{tabu}

У `X` может быть несколько параметров - вес коэффициента ширины ячейки (число),
выравнивание по горизонтали и вертикали. Например, если нужна колонка в 2 раза шире
чем обычная и выровненная по правому краю, для нее указываем `X[2,r]`.

У пакета `tabu` есть окружение `longtabu`, расширяющее функционал пакета `longtable`
колонками типа `X`. Чтобы его использовать, надо подключить оба пакета `tabu` и `longtable`.

Команды заголовков и подвала `longtabu` наследует от `longtable`.

У меня возникли проблемы с `longtabu` когда у меня в заголовке были многоколоночные
ячейки (`\multicolumn`). Для них нельзя указать тип `X`, поэтому заголовок у меня не
попадал в основную таблицу. К сожалению, `\multicolumn` для `tabu` еще не реализован,
так что приходится использовать workaround через `\tabuphantomline`, примерно так:

    \begin{longtabu} to \linewidth{|r|X[L]|r|X[L]|r|X[L]|X[R]|l|} \tabucline-
    
    \hline
    \multicolumn2{|c|}{COLUMN1} & \multicolumn2{c|}{COLUMN2} & \multicolumn4{c|}{COLUMN3} \\ \tabucline-
    \tabuphantomline
    \hline
    \endfirsthead
    ...
    \end{longtabu}

Здесь используется таблица с 8 колонками разного типа. Заголовки многоколоночные,
ширина получается точно такая, как у ячеек таблицы.

Использование этого workaround не совсем очевидно из документации, но это работает.


[longtable-example]: http://texblog.org/2011/05/15/multi-page-tables-using-longtable/
[tabu]: http://www.ctan.org/pkg/tabu



